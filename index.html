
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMSU Stallion AI Companion | Academic Portal</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              mmsu: {
                green: '#014421',
                gold: '#FFD700',
                darkGreen: '#003318',
                lightGold: '#FFF2B2'
              }
            }
          }
        }
      }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
      @tailwind base;
      @tailwind components;
      @tailwind utilities;

      :root {
        --mmsu-green: #014421;
        --mmsu-dark-green: #003318;
        --mmsu-gold: #FFD700;
      }

      html, body {
        @apply transition-colors duration-300;
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .animate-fadeIn {
        animation: fadeIn 0.4s ease-out forwards;
      }

      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(1, 68, 33, 0.2);
        border-radius: 10px;
      }

      .dark ::-webkit-scrollbar-thumb {
        background: rgba(255, 215, 0, 0.1);
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "@google/genai": "https://esm.sh/@google/genai@^1.41.0"
  }
}
</script>
</head>
<body class="antialiased selection:bg-mmsu-gold selection:text-mmsu-green bg-slate-50 dark:bg-slate-900">
    <div id="root"></div>

    <script type="module">
      import React, { useState, useEffect, useRef } from 'https://esm.sh/react@19.0.0';
      import { createRoot } from 'https://esm.sh/react-dom@19.0.0/client';
      import htm from 'https://esm.sh/htm';
      import { GoogleGenAI } from "https://esm.sh/@google/genai@1.41.0";

      // Initialize htm with React
      const html = htm.bind(React.createElement);

      // --- CONSTANTS ---
      const COLLEGES = [
        'College of Agriculture, Food and Sustainable Development',
        'College of Aquatic Science and Applied Technology',
        'College of Arts and Sciences',
        'College of Business, Economics and Accountancy',
        'College of Computing and Information Sciences',
        'College of Engineering',
        'College of Health Sciences',
        'College of Industrial Technology',
        'College of Teacher Education',
        'College of Medicine',
        'College of Law',
        'Graduate School'
      ];

      const MOCK_COURSES = [
        { id: 'c1', code: 'AGRI 101', title: 'Fundamentals of Crop Science', college: 'College of Agriculture, Food and Sustainable Development', description: 'Basic principles of plant growth and management.', credits: 3 },
        { id: 'c5', code: 'BIO 101', title: 'General Biology', college: 'College of Arts and Sciences', description: 'Study of life and living organisms.', credits: 4 },
        { id: 'c9', code: 'IT 101', title: 'Introduction to Computing', college: 'College of Computing and Information Sciences', description: 'Fundamental concepts of computer hardware and software.', credits: 3 },
        { id: 'c10', code: 'CMPSC 146', title: 'Software Engineering', college: 'College of Computing and Information Sciences', description: 'Systematic approach to software development.', credits: 3 },
        { id: 'c12', code: 'CE 201', title: 'Statics of Rigid Bodies', college: 'College of Engineering', description: 'Analysis of force systems in equilibrium.', credits: 3 },
      ];

      const MOCK_ANNOUNCEMENTS = [
        { id: 'a1', title: 'Second Semester Enrollment AY 2025-2026', date: 'January 12, 2026', content: 'Final week for adding/dropping subjects. Please visit your college registrar.', category: 'Enrollment' },
        { id: 'a2', title: '2026 Scholarship Renewal', date: 'January 18, 2026', content: 'Submit your 1st Semester grades to the OSA for renewal.', category: 'Scholarship' },
        { id: 'a3', title: 'MMSU 48th Foundation Anniversary', date: 'January 20, 2026', content: 'Happy Foundation Day, Stallions! Join us for the celebration.', category: 'Event' },
      ];

      // --- AI SERVICE ---
      async function fetchAI(prompt, college, mode, studentId, history) {
        try {
          const ai = new GoogleGenAI({ apiKey: "YOUR_API_KEY_HERE" || "API_KEY_NOT_SET" });
          // In this environment, process.env.API_KEY is handled, but for GitHub Pages, users often hardcode or use secrets.
          // Note: Standard Senior guideline is to use process.env.API_KEY.
          const realAi = new GoogleGenAI({ apiKey: "${process.env.API_KEY}" }); 
          
          const systemInstruction = `
            You are the "MMSU Stallion AI Companion" for Mariano Marcos State University.
            User is in the ${college}. Date: Jan 20, 2026 (Foundation Day).
            Mode: ${mode === 'TUTORING' ? 'Specialized Tutoring' : 'General Assistance'}.
            Constraints: Strictly MMSU-based. Formal English. No asterisks.
          `;

          const contents = history.map(m => ({
            role: m.role === 'user' ? 'user' : 'model',
            parts: [{ text: m.content }]
          }));
          contents.push({ role: 'user', parts: [{ text: prompt }] });

          const response = await realAi.models.generateContent({
            model: 'gemini-3-flash-preview',
            contents,
            config: { systemInstruction, tools: [{ googleSearch: {} }], temperature: 0.7 }
          });

          const links = response.candidates?.[0]?.groundingMetadata?.groundingChunks
            ?.filter(c => c.web).map(c => ({ title: c.web.title, uri: c.web.uri })) || [];

          return { text: response.text, links };
        } catch (e) {
          return { text: "Connection to Stallion Network lost. Please try again.", links: [] };
        }
      }

      // --- COMPONENTS ---

      const App = () => {
        const [activeTab, setActiveTab] = useState('home');
        const [user, setUser] = useState({
          name: 'Stallion Guest',
          college: 'College of Computing and Information Sciences',
          campus: 'Batac',
          theme: 'dark',
          studentId: ''
        });
        const [messages, setMessages] = useState([]);
        const [input, setInput] = useState('');
        const [isTyping, setIsTyping] = useState(false);
        const [chatMode, setChatMode] = useState('GENERAL');
        const [showSettings, setShowSettings] = useState(false);
        const chatEndRef = useRef(null);

        useEffect(() => {
          document.documentElement.classList.toggle('dark', user.theme === 'dark');
        }, [user.theme]);

        useEffect(() => {
          chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [messages, isTyping]);

        const handleSend = async (customText) => {
          const val = customText || input;
          if (!val.trim()) return;
          const userMsg = { role: 'user', content: val, id: Date.now() };
          setMessages(prev => [...prev, userMsg]);
          setInput('');
          setIsTyping(true);

          const result = await fetchAI(val, user.college, chatMode, user.studentId, messages);
          setMessages(prev => [...prev, { role: 'assistant', content: result.text, links: result.links, id: Date.now() + 1 }]);
          setIsTyping(false);
        };

        return html`
          <div className="min-h-screen flex flex-col transition-colors duration-500 ${user.theme === 'dark' ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-900'}">
            
            {/* Header */}
            <header className="sticky top-0 z-50 bg-mmsu-green text-white shadow-lg border-b border-mmsu-gold/30">
              <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                <div className="flex items-center space-x-3 cursor-pointer" onClick=${() => setActiveTab('home')}>
                  <div className="w-12 h-12 bg-mmsu-gold rounded-full flex items-center justify-center text-mmsu-green text-2xl shadow-inner">
                    <i className="fas fa-horse"></i>
                  </div>
                  <div>
                    <h1 className="font-black text-xl leading-none uppercase tracking-tight">MMSU Stallion</h1>
                    <p className="text-[10px] text-mmsu-gold uppercase tracking-[0.2em] font-bold">Companion</p>
                  </div>
                </div>
                <div className="flex items-center space-x-4">
                  <button onClick=${() => setUser({ ...user, theme: user.theme === 'dark' ? 'light' : 'dark' })} className="p-2 hover:bg-white/10 rounded-xl">
                    <i className="fas ${user.theme === 'dark' ? 'fa-sun' : 'fa-moon'}"></i>
                  </button>
                  <button onClick=${() => setShowSettings(true)} className="w-10 h-10 rounded-full border border-mmsu-gold/50 flex items-center justify-center bg-white/10">
                    <i className="fas fa-user"></i>
                  </button>
                </div>
              </div>
            </header>

            {/* Main Content */}
            <main className="flex-1 max-w-7xl mx-auto w-full p-6 pb-24">
              
              {activeTab === 'home' && html`
                <div className="space-y-10 animate-fadeIn">
                  <section className="bg-gradient-to-br from-mmsu-green to-mmsu-darkGreen text-white p-10 md:p-20 rounded-[3rem] shadow-2xl relative overflow-hidden border border-white/10">
                    <div className="relative z-10 space-y-6">
                      <div className="inline-flex items-center space-x-2 bg-mmsu-gold/20 px-4 py-1.5 rounded-full border border-mmsu-gold/30">
                        <span className="w-2 h-2 bg-mmsu-gold rounded-full animate-pulse"></span>
                        <span className="text-mmsu-gold text-xs font-bold uppercase tracking-wider">Jan 20, 2026 â€¢ Foundation Day</span>
                      </div>
                      <h2 className="text-4xl md:text-6xl font-black tracking-tight leading-tight">Rise Higher, <span className="text-mmsu-gold block">Stallion ${user.name.split(' ')[0]}!</span></h2>
                      <p className="text-base opacity-90 max-w-2xl font-medium">Academic Portal for <span className="text-mmsu-gold">${user.college}</span></p>
                      <button onClick=${() => setActiveTab('chat')} className="bg-mmsu-gold text-mmsu-green px-10 py-4 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl hover:scale-105 transition-all">Launch Assistant</button>
                    </div>
                    <i className="fas fa-graduation-cap absolute top-0 right-0 text-[20rem] opacity-5 -rotate-12 transform translate-x-20"></i>
                  </section>

                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-10">
                    <div className="lg:col-span-2 space-y-6">
                      <h3 className="text-xl font-black flex items-center"><span className="w-1.5 h-6 bg-mmsu-green rounded-full mr-3"></span> Latest Bulletins</h3>
                      <div className="grid gap-4">
                        ${MOCK_ANNOUNCEMENTS.map(ann => html`
                          <div key=${ann.id} className="p-6 rounded-3xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800/50 hover:shadow-xl transition-all">
                            <div className="flex justify-between items-start mb-2">
                              <span className="text-[10px] px-2 py-0.5 rounded bg-mmsu-gold/10 text-mmsu-green font-bold uppercase">${ann.category}</span>
                              <span className="text-[10px] text-gray-400">${ann.date}</span>
                            </div>
                            <h4 className="font-bold text-lg mb-2">${ann.title}</h4>
                            <p className="text-sm text-gray-500 dark:text-gray-400 line-clamp-2">${ann.content}</p>
                          </div>
                        `)}
                      </div>
                    </div>
                    <div className="space-y-6">
                      <h3 className="text-xl font-black flex items-center"><span className="w-1.5 h-6 bg-mmsu-gold rounded-full mr-3"></span> Tools</h3>
                      <div className="grid gap-4">
                        ${[
                          { icon: 'fa-globe-asia', label: 'Official Site', url: 'https://mmsu.edu.ph' },
                          { icon: 'fa-graduation-cap', label: 'MVLE Learning', url: 'https://mvle4.mmsu.edu.ph' },
                          { icon: 'fa-user-circle', label: 'Student Portal', url: 'https://mys.mmsu.edu.ph' },
                        ].map(tool => html`
                          <button key=${tool.label} onClick=${() => window.open(tool.url, '_blank')} className="flex items-center p-5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl hover:border-mmsu-gold transition-all group">
                            <div className="w-12 h-12 bg-mmsu-green text-white rounded-xl flex items-center justify-center mr-4 group-hover:scale-110 transition-transform shadow-lg">
                              <i className="fas ${tool.icon}"></i>
                            </div>
                            <span className="font-black text-sm uppercase tracking-widest">${tool.label}</span>
                          </button>
                        `)}
                      </div>
                    </div>
                  </div>
                </div>
              `}

              {activeTab === 'chat' && html`
                <div className="flex flex-col h-[calc(100vh-280px)] bg-white dark:bg-slate-800 rounded-[3rem] shadow-2xl border border-gray-100 dark:border-slate-700 overflow-hidden animate-fadeIn">
                  <div className="px-8 py-5 flex items-center justify-between ${chatMode === 'TUTORING' ? 'bg-mmsu-gold text-mmsu-green' : 'bg-mmsu-green text-white'}">
                    <div className="flex items-center space-x-3">
                      <i className="fas ${chatMode === 'TUTORING' ? 'fa-user-graduate' : 'fa-robot'} text-xl"></i>
                      <span className="font-black uppercase text-sm tracking-widest">${chatMode === 'TUTORING' ? 'Tutor Mode' : 'Assistant Mode'}</span>
                    </div>
                    <div className="flex bg-black/10 p-1 rounded-xl">
                      <button onClick=${() => setChatMode('GENERAL')} className="px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest ${chatMode === 'GENERAL' ? 'bg-white text-mmsu-green' : 'text-white/70'}">General</button>
                      <button onClick=${() => setChatMode('TUTORING')} className="px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest ${chatMode === 'TUTORING' ? 'bg-white text-mmsu-green' : 'text-white/70'}">Tutor</button>
                    </div>
                  </div>
                  <div className="flex-1 overflow-y-auto p-8 space-y-8 bg-slate-50/50 dark:bg-slate-900/50">
                    ${messages.map(m => html`
                      <div key=${m.id} className="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'} animate-fadeIn">
                        <div className="max-w-[85%] space-y-2">
                          <div className="p-5 rounded-3xl ${m.role === 'user' ? 'bg-mmsu-green text-white rounded-tr-none shadow-mmsu-green/20' : 'bg-white dark:bg-slate-800 dark:text-white rounded-tl-none border border-gray-100 dark:border-slate-700 shadow-xl shadow-black/5'}">
                            <p className="text-sm leading-relaxed">${m.content}</p>
                            ${m.links && m.links.length > 0 && html`
                              <div className="mt-4 pt-4 border-t border-gray-100 dark:border-slate-700">
                                <p className="text-[8px] font-black uppercase opacity-50 mb-2">Sources</p>
                                <div className="flex flex-wrap gap-2">
                                  ${m.links.map((l, i) => html`
                                    <a key=${i} href=${l.uri} target="_blank" className="text-[9px] bg-slate-100 dark:bg-slate-700 px-3 py-1.5 rounded-xl font-bold flex items-center gap-2 hover:bg-mmsu-gold transition-colors">
                                      <i className="fas fa-link scale-75"></i> \${l.title}
                                    </a>
                                  `)}
                                </div>
                              </div>
                            `}
                          </div>
                          <p className="text-[8px] font-black uppercase opacity-30 text-center tracking-widest">${m.role === 'user' ? 'Stallion' : 'Companion'}</p>
                        </div>
                      </div>
                    `)}
                    ${isTyping && html`<div className="text-[10px] font-black uppercase opacity-40 animate-pulse">Assistant is thinking...</div>`}
                    <div ref=${chatEndRef}></div>
                  </div>
                  <div className="p-8 bg-white dark:bg-slate-800 border-t border-gray-100 dark:border-slate-700">
                    <div className="flex gap-4">
                      <input 
                        value=${input} 
                        onChange=${(e) => setInput(e.target.value)}
                        onKeyDown=${(e) => e.key === 'Enter' && handleSend()}
                        placeholder="Ask anything about MMSU..."
                        className="flex-1 bg-gray-50 dark:bg-slate-900 border-none rounded-2xl px-6 py-4 text-sm font-medium focus:ring-2 focus:ring-mmsu-green dark:text-white"
                      />
                      <button onClick=${() => handleSend()} className="w-14 h-14 bg-mmsu-green text-white rounded-2xl flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all">
                        <i className="fas fa-paper-plane"></i>
                      </button>
                    </div>
                  </div>
                </div>
              `}

              {activeTab === 'courses' && html`
                <div className="space-y-10 animate-fadeIn">
                  <div className="flex justify-between items-end">
                    <h2 className="text-3xl font-black">Course Catalog</h2>
                    <p className="text-[10px] font-black uppercase tracking-widest opacity-40">Active Syllabus: ${user.college}</p>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    ${MOCK_COURSES.map(c => html`
                      <div key=${c.id} className="p-8 bg-white dark:bg-gray-800 rounded-[2.5rem] border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-2xl transition-all group">
                        <span className="text-[10px] font-black bg-mmsu-gold/20 text-mmsu-green px-3 py-1 rounded-full uppercase tracking-tighter border border-mmsu-gold/30">${c.code}</span>
                        <h4 className="font-bold text-xl mt-6 group-hover:text-mmsu-green transition-colors">${c.title}</h4>
                        <p className="text-sm text-gray-500 mt-4 italic leading-relaxed">"${c.description}"</p>
                        <div className="mt-8 pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center text-[10px] font-black uppercase text-gray-400">
                          <span>${c.credits} Units</span>
                          <span className="text-mmsu-green">View Details <i className="fas fa-chevron-right ml-1"></i></span>
                        </div>
                      </div>
                    `)}
                  </div>
                </div>
              `}

              {activeTab === 'tutors' && html`
                <div className="max-w-4xl mx-auto p-12 md:p-24 bg-mmsu-darkGreen rounded-[4rem] text-center text-white space-y-10 animate-fadeIn shadow-2xl relative overflow-hidden">
                  <i className="fas fa-robot text-[10rem] text-mmsu-gold opacity-10 absolute -top-10 -right-10 rotate-12"></i>
                  <div className="relative z-10 space-y-8">
                    <div className="w-24 h-24 bg-mmsu-gold rounded-3xl flex items-center justify-center text-mmsu-green text-4xl mx-auto shadow-2xl"><i className="fas fa-user-graduate"></i></div>
                    <h2 className="text-5xl font-black tracking-tighter">Stallion Tutor Room</h2>
                    <p className="text-lg text-mmsu-gold/80 max-w-xl mx-auto font-medium">Get 24/7 academic deep-dives and complex concept explanations grounded in university curriculum data.</p>
                    <button onClick=${() => { setChatMode('TUTORING'); setActiveTab('chat'); }} className="bg-white text-mmsu-green px-12 py-5 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl hover:bg-mmsu-gold transition-all">Start Tutoring Session</button>
                  </div>
                </div>
              `}
            </main>

            {/* Navigation Dock */}
            <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white dark:bg-slate-800 p-2 rounded-full shadow-2xl border border-gray-100 dark:border-slate-700 flex space-x-2 z-[60]">
              ${[
                { id: 'home', icon: 'fa-home', label: 'Home' },
                { id: 'chat', icon: 'fa-comments', label: 'AI Chat' },
                { id: 'courses', icon: 'fa-book', label: 'Catalog' },
                { id: 'tutors', icon: 'fa-user-graduate', label: 'Tutor' },
              ].map(t => html`
                <button 
                  key=${t.id}
                  onClick=${() => setActiveTab(t.id)}
                  className="flex items-center space-x-3 px-6 py-3 rounded-full transition-all \${activeTab === t.id ? 'bg-mmsu-green text-white shadow-xl' : 'text-gray-400 hover:text-mmsu-green'}"
                >
                  <i className="fas \${t.icon}"></i>
                  <span className="text-[10px] font-black uppercase tracking-widest \${activeTab === t.id ? 'block' : 'hidden md:block'}">\${t.label}</span>
                </button>
              `)}
            </nav>

            {/* Settings Modal */}
            ${showSettings && html`
              <div className="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-[100] p-6">
                <div className="bg-white dark:bg-slate-900 p-10 rounded-[3rem] max-w-lg w-full border border-gray-100 dark:border-gray-800 shadow-2xl space-y-8 animate-fadeIn">
                  <div className="flex justify-between items-center">
                    <h3 className="text-2xl font-black tracking-tighter">Student Profile</h3>
                    <button onClick=${() => setShowSettings(false)} className="w-10 h-10 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"><i className="fas fa-times"></i></button>
                  </div>
                  <div className="space-y-6">
                    <div className="space-y-2">
                      <label className="text-[10px] font-black uppercase text-gray-400 ml-4">Full Name</label>
                      <input className="w-full p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl border-none focus:ring-2 focus:ring-mmsu-green font-bold" value=${user.name} onChange=${e => setUser({ ...user, name: e.target.value })} />
                    </div>
                    <div className="space-y-2">
                      <label className="text-[10px] font-black uppercase text-gray-400 ml-4">MMSU College</label>
                      <select className="w-full p-4 bg-gray-50 dark:bg-gray-800 rounded-2xl border-none font-bold text-sm" value=${user.college} onChange=${e => setUser({ ...user, college: e.target.value })}>
                        ${COLLEGES.map(c => html`<option key=${c} value=${c}>${c}</option>`)}
                      </select>
                    </div>
                  </div>
                  <button onClick=${() => setShowSettings(false)} className="w-full bg-mmsu-green text-white py-5 rounded-2xl font-black uppercase tracking-widest text-xs shadow-xl">Update Academic Profile</button>
                </div>
              </div>
            `}
          </div>
        `;
      };

      const root = createRoot(document.getElementById('root'));
      root.render(html`<${App} />`);
    </script>
</body>
</html>
